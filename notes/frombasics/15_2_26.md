Below is the **same GreenhouseApi documentation**, rewritten to use **plain synchronous code** (no `async`, no `Task`, no `await`, no `CancellationToken`).

This version is easier for **beginners and students** to understand.

Target: **.NET 8 â€“ Simple Synchronous Style**

---

# ðŸŒ± Create GreenhouseApi (Synchronous Version) Using .NET CLI

This guide creates a **Greenhouse IoT Web API** using **simple blocking code**.

No async/await.

---

# âœ… Prerequisites

Install .NET 8 SDK.

Check:

```powershell
dotnet --version
```

You should see `8.0.x`.

---

# âœ… Step 1: Create Web API Project

```powershell
dotnet new webapi -n GreenhouseApi -o GreenhouseApi
cd GreenhouseApi
```

---

# âœ… Step 2: (Optional) Create Solution

```powershell
dotnet new sln -n GreenhouseApi
dotnet sln add GreenhouseApi.csproj
```

---

# âœ… Step 3: Add Swagger

```powershell
dotnet add package Swashbuckle.AspNetCore
```

---

# âœ… Step 4: Project File (Optional)

`GreenhouseApi.csproj`

```xml
<Project Sdk="Microsoft.NET.Sdk.Web">

  <PropertyGroup>
    <TargetFramework>net8.0</TargetFramework>
    <Nullable>enable</Nullable>
    <ImplicitUsings>enable</ImplicitUsings>
  </PropertyGroup>

</Project>
```

---

# âœ… Step 5: Create Folders

```powershell
mkdir Models
mkdir Repositories
mkdir Services
mkdir Controllers
```

---

# âœ… Step 6: Remove Template Files

```powershell
Remove-Item Controllers/WeatherForecastController.cs
Remove-Item WeatherForecast.cs
```

---

# âœ… Step 7: Models

---

## 7.1 SensorReading.cs

`Models/SensorReading.cs`

```csharp
namespace GreenhouseApi.Models;

public class SensorReading
{
    public int Id { get; set; }

    public string GreenhouseId { get; set; } = "";

    public string SensorType { get; set; } = "";

    public double Value { get; set; }

    public string Unit { get; set; } = "";

    public DateTime Timestamp { get; set; }
}
```

---

## 7.2 GreenhouseData.cs

`Models/GreenhouseData.cs`

```csharp
namespace GreenhouseApi.Models;

public class GreenhouseData
{
    public List<SensorReading> SensorReadings { get; set; } = new();
}
```

---

# âœ… Step 8: Repository Layer (Synchronous)

---

## 8.1 GreenhouseOptions.cs

`Repositories/GreenhouseOptions.cs`

```csharp
namespace GreenhouseApi.Repositories;

public class GreenhouseOptions
{
    public const string SectionName = "Greenhouse";

    public string JsonFilePath { get; set; } = "greenhouse.json";
}
```

---

## 8.2 IGreenhouseRepository.cs (No Task)

`Repositories/IGreenhouseRepository.cs`

```csharp
using GreenhouseApi.Models;

namespace GreenhouseApi.Repositories;

public interface IGreenhouseRepository
{
    IReadOnlyList<SensorReading> GetAll();

    SensorReading? GetById(int id);

    SensorReading Add(SensorReading reading);

    SensorReading? Update(int id, SensorReading reading);

    bool Delete(int id);
}
```

---

## 8.3 GreenhouseRepository.cs (No Async)

`Repositories/GreenhouseRepository.cs`

```csharp
using System.Text.Json;
using GreenhouseApi.Models;
using Microsoft.Extensions.Options;

namespace GreenhouseApi.Repositories;

public class GreenhouseRepository : IGreenhouseRepository
{
    private readonly string _filePath;

    private static readonly JsonSerializerOptions JsonOptions =
        new()
        {
            PropertyNamingPolicy = JsonNamingPolicy.CamelCase,
            WriteIndented = true
        };

    public GreenhouseRepository(IOptions<GreenhouseOptions> options)
    {
        _filePath = options.Value.JsonFilePath;
    }

    private GreenhouseData LoadData()
    {
        if (!File.Exists(_filePath))
            return new GreenhouseData();

        var json = File.ReadAllText(_filePath);

        var data = JsonSerializer.Deserialize<GreenhouseData>(json, JsonOptions);

        return data ?? new GreenhouseData();
    }

    private void SaveData(GreenhouseData data)
    {
        var json = JsonSerializer.Serialize(data, JsonOptions);

        File.WriteAllText(_filePath, json);
    }

    public IReadOnlyList<SensorReading> GetAll()
    {
        var data = LoadData();

        return data.SensorReadings;
    }

    public SensorReading? GetById(int id)
    {
        var data = LoadData();

        return data.SensorReadings.FirstOrDefault(r => r.Id == id);
    }

    public SensorReading Add(SensorReading reading)
    {
        var data = LoadData();

        int nextId =
            data.SensorReadings.Count == 0
            ? 1
            : data.SensorReadings.Max(r => r.Id) + 1;

        reading.Id = nextId;

        if (reading.Timestamp == default)
            reading.Timestamp = DateTime.UtcNow;

        data.SensorReadings.Add(reading);

        SaveData(data);

        return reading;
    }

    public SensorReading? Update(int id, SensorReading reading)
    {
        var data = LoadData();

        var index =
            data.SensorReadings.FindIndex(r => r.Id == id);

        if (index < 0)
            return null;

        reading.Id = id;

        data.SensorReadings[index] = reading;

        SaveData(data);

        return reading;
    }

    public bool Delete(int id)
    {
        var data = LoadData();

        int removed =
            data.SensorReadings.RemoveAll(r => r.Id == id);

        if (removed == 0)
            return false;

        SaveData(data);

        return true;
    }
}
```

---

# âœ… Step 9: Service Layer (Synchronous)

---

## 9.1 IGreenhouseService.cs

`Services/IGreenhouseService.cs`

```csharp
using GreenhouseApi.Models;

namespace GreenhouseApi.Services;

public interface IGreenhouseService
{
    IReadOnlyList<SensorReading> GetAllReadings();

    SensorReading? GetReadingById(int id);

    SensorReading CreateReading(SensorReading reading);

    SensorReading? UpdateReading(int id, SensorReading reading);

    bool DeleteReading(int id);
}
```

---

## 9.2 GreenhouseService.cs

`Services/GreenhouseService.cs`

```csharp
using GreenhouseApi.Models;
using GreenhouseApi.Repositories;

namespace GreenhouseApi.Services;

public class GreenhouseService : IGreenhouseService
{
    private readonly IGreenhouseRepository _repository;

    public GreenhouseService(IGreenhouseRepository repository)
    {
        _repository = repository;
    }

    public IReadOnlyList<SensorReading> GetAllReadings()
        => _repository.GetAll();

    public SensorReading? GetReadingById(int id)
        => _repository.GetById(id);

    public SensorReading CreateReading(SensorReading reading)
        => _repository.Add(reading);

    public SensorReading? UpdateReading(int id, SensorReading reading)
        => _repository.Update(id, reading);

    public bool DeleteReading(int id)
        => _repository.Delete(id);
}
```

---

# âœ… Step 10: Controller (No Async)

---

## GreenhouseController.cs

`Controllers/GreenhouseController.cs`

```csharp
using GreenhouseApi.Models;
using GreenhouseApi.Services;
using Microsoft.AspNetCore.Mvc;

namespace GreenhouseApi.Controllers;

[ApiController]
[Route("api/[controller]")]
public class GreenhouseController : ControllerBase
{
    private readonly IGreenhouseService _service;

    public GreenhouseController(IGreenhouseService service)
    {
        _service = service;
    }

    [HttpGet]
    public ActionResult<IReadOnlyList<SensorReading>> GetAll()
    {
        var data = _service.GetAllReadings();

        return Ok(data);
    }

    [HttpGet("{id}")]
    public ActionResult<SensorReading> GetById(int id)
    {
        var item = _service.GetReadingById(id);

        if (item == null)
            return NotFound();

        return Ok(item);
    }

    [HttpPost]
    public ActionResult<SensorReading> Create(SensorReading reading)
    {
        var created = _service.CreateReading(reading);

        return CreatedAtAction(
            nameof(GetById),
            new { id = created.Id },
            created);
    }

    [HttpPut("{id}")]
    public ActionResult<SensorReading> Update(int id, SensorReading reading)
    {
        var updated = _service.UpdateReading(id, reading);

        if (updated == null)
            return NotFound();

        return Ok(updated);
    }

    [HttpDelete("{id}")]
    public IActionResult Delete(int id)
    {
        var result = _service.DeleteReading(id);

        if (!result)
            return NotFound();

        return NoContent();
    }
}
```

---

# âœ… Step 11: Program.cs

`Program.cs`

```csharp
using GreenhouseApi.Repositories;
using GreenhouseApi.Services;

var builder = WebApplication.CreateBuilder(args);

// Options
builder.Services.Configure<GreenhouseOptions>(
    builder.Configuration.GetSection(GreenhouseOptions.SectionName));

// DI
builder.Services.AddScoped<IGreenhouseRepository, GreenhouseRepository>();
builder.Services.AddScoped<IGreenhouseService, GreenhouseService>();

builder.Services.AddControllers();

builder.Services.AddEndpointsApiExplorer();
builder.Services.AddSwaggerGen();

var app = builder.Build();

if (app.Environment.IsDevelopment())
{
    app.UseSwagger();
    app.UseSwaggerUI();
}

app.UseHttpsRedirection();

app.UseAuthorization();

app.MapControllers();

app.Run();
```

---

# âœ… Step 12: appsettings.json

`appsettings.json`

```json
{
  "Logging": {
    "LogLevel": {
      "Default": "Information",
      "Microsoft.AspNetCore": "Warning"
    }
  },
  "AllowedHosts": "*",

  "Greenhouse": {
    "JsonFilePath": "greenhouse.json"
  }
}
```

---

# âœ… Step 13: Run Project

```powershell
dotnet restore
dotnet build
dotnet run
```

Open:

```
https://localhost:5001/swagger
```

---

# âœ… Step 14: Test API

Try in Swagger:

| Method | URL                  |
| ------ | -------------------- |
| GET    | /api/greenhouse      |
| POST   | /api/greenhouse      |
| PUT    | /api/greenhouse/{id} |
| DELETE | /api/greenhouse/{id} |

---

# âœ… Step 15: Project Structure

```
GreenhouseApi/
â”‚
â”œâ”€â”€ Controllers/
â”‚   â””â”€â”€ GreenhouseController.cs
â”‚
â”œâ”€â”€ Models/
â”‚   â”œâ”€â”€ SensorReading.cs
â”‚   â””â”€â”€ GreenhouseData.cs
â”‚
â”œâ”€â”€ Repositories/
â”‚   â”œâ”€â”€ IGreenhouseRepository.cs
â”‚   â”œâ”€â”€ GreenhouseRepository.cs
â”‚   â””â”€â”€ GreenhouseOptions.cs
â”‚
â”œâ”€â”€ Services/
â”‚   â”œâ”€â”€ IGreenhouseService.cs
â”‚   â””â”€â”€ GreenhouseService.cs
â”‚
â”œâ”€â”€ Program.cs
â”œâ”€â”€ appsettings.json
â”œâ”€â”€ greenhouse.json (optional)
â””â”€â”€ GreenhouseApi.csproj
```

---

# ðŸŽ¯ Why This Version Is Good for Learning

This synchronous version helps you understand:

- âœ… Layered Architecture
- âœ… File-based persistence
- âœ… Dependency Injection
- âœ… REST APIs
- âœ… CRUD operations